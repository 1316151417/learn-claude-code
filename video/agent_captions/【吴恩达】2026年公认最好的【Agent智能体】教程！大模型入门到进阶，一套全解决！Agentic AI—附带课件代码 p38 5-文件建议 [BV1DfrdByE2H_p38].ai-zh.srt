1
00:00:00,180 --> 00:00:02,840
你现在将设置系统中的第二个代理

2
00:00:02,840 --> 00:00:05,200
文件建议代理

3
00:00:05,200 --> 00:00:11,460
该代理将帮助你从结构化数据中选择相关文件以构建领域图

4
00:00:11,580 --> 00:00:15,140
让我们进入你正在处理的工作流程

5
00:00:15,140 --> 00:00:19,110
你正在第四课中构建结构化数据代理工作流程

6
00:00:19,110 --> 00:00:22,390
你在此第五课中创建了用户意图代理

7
00:00:22,390 --> 00:00:25,020
你将创建文件建议代理

8
00:00:25,020 --> 00:00:29,180
你将采用与第四课用户意图代理类似的模式

9
00:00:29,180 --> 00:00:31,990
该代理本身有一个主要目标

10
00:00:31,990 --> 00:00:34,150
创建此批准文件列表

11
00:00:34,150 --> 00:00:38,379
这将是代理自身需要查看的文件列表

12
00:00:38,379 --> 00:00:41,479
并决定这些文件对用户要完成的任务是否相关

13
00:00:41,479 --> 00:00:43,510
然后询问用户

14
00:00:43,510 --> 00:00:44,650
你批准这些吗

15
00:00:44,650 --> 00:00:48,660
如果同意，输出将是执行该操作的批准文件

16
00:00:48,660 --> 00:00:50,940
文件建议代理包含许多工具

17
00:00:50,940 --> 00:00:53,410
用于查看可用的文件

18
00:00:53,410 --> 00:00:56,570
这是所有文件的列表

19
00:00:56,570 --> 00:01:00,510
它可以对文件进行采样，进行少量读取

20
00:01:00,510 --> 00:01:02,550
它只能读取约一百行

21
00:01:02,550 --> 00:01:06,110
然后基于此使用该工具进行推荐

22
00:01:06,110 --> 00:01:07,970
称为设置建议文件工具

23
00:01:07,970 --> 00:01:09,710
如果用户批准

24
00:01:09,710 --> 00:01:12,260
将调用批准建议文件工具

25
00:01:12,260 --> 00:01:13,680
这将更新记忆

26
00:01:13,680 --> 00:01:16,660
以便在上下文中包含批准文件

27
00:01:16,660 --> 00:01:19,180
而不仅仅是建议文件

28
00:01:19,180 --> 00:01:19,860
所有这些

29
00:01:19,860 --> 00:01:23,180
当然受前一代理工作的指导

30
00:01:23,180 --> 00:01:27,630
所有操作均基于用户要完成的整体目标

31
00:01:27,630 --> 00:01:32,110
该代理从记忆中获取这些信息而非对话历史

32
00:01:32,110 --> 00:01:36,370
因此不依赖于该工具被调用前的对话记录

33
00:01:36,370 --> 00:01:38,240
或该代理被调用前的对话

34
00:01:38,240 --> 00:01:41,360
此代理将使用获取批准用户目标工具

35
00:01:41,360 --> 00:01:44,720
确定用户要完成的任务是什么

36
00:01:44,720 --> 00:01:46,920
然后查看文件

37
00:01:46,920 --> 00:01:48,340
确定哪些相关

38
00:01:48,340 --> 00:01:50,430
并向用户提出建议

39
00:01:50,430 --> 00:01:52,030
让我们看看代码

40
00:01:52,030 --> 00:01:53,810
你将从常规设置开始

41
00:01:53,810 --> 00:01:58,110
导入所需库和之前定义的辅助函数

42
00:01:59,640 --> 00:02:00,980
已有这些库

43
00:02:00,980 --> 00:02:05,240
我们将连接OpenAI并确保其正常运行

44
00:02:07,040 --> 00:02:07,440
哦

45
00:02:07,440 --> 00:02:08,740
今天非常稳定

46
00:02:08,740 --> 00:02:09,080
是的

47
00:02:09,080 --> 00:02:09,580
我准备好了

48
00:02:09,580 --> 00:02:11,520
如何帮助您

49
00:02:12,289 --> 00:02:15,449
你将开始构建代理自身的指令

50
00:02:16,729 --> 00:02:19,560
现在我们将逐步进行

51
00:02:19,560 --> 00:02:21,340
你想要定义代理的角色

52
00:02:21,340 --> 00:02:22,810
同时也要设定其目标

53
00:02:22,810 --> 00:02:27,170
对于负责建议相关文件的代理

54
00:02:27,170 --> 00:02:29,790
我们将称其为建设性批评者

55
00:02:29,790 --> 00:02:31,900
正在审查文件列表

56
00:02:31,900 --> 00:02:38,220
其目标是建议可用于构建知识图谱的相关文件

57
00:02:38,720 --> 00:02:42,200
然后你可以提供一些执行任务的提示

58
00:02:42,200 --> 00:02:43,400
特定的任务

59
00:02:43,400 --> 00:02:47,340
当然就是审查文件列表并查看其中

60
00:02:47,340 --> 00:02:53,840
哪些文件对基于已批准用户目标的描述中的图谱相关

61
00:02:53,840 --> 00:02:55,220
对于每个文件

62
00:02:55,220 --> 00:02:58,029
有一个名为样本文件的工具可用

63
00:02:58,029 --> 00:03:01,169
可以让代理实际查看该文件内容

64
00:03:01,169 --> 00:03:05,920
以确认文件是否包含对实现目标有用的信息

65
00:03:05,920 --> 00:03:07,000
我们正在提供

66
00:03:07,000 --> 00:03:09,760
同时提示它只需查看结构化数据文件

67
00:03:09,760 --> 00:03:11,930
如csv或json

68
00:03:11,970 --> 00:03:15,210
可以用思维链方向收尾

69
00:03:15,210 --> 00:03:17,870
此处的思维链包含两个部分

70
00:03:17,870 --> 00:03:20,410
首先是准备阶段

71
00:03:20,410 --> 00:03:24,440
先调用获取已批准用户目标工具

72
00:03:24,440 --> 00:03:26,000
从会话记忆中获取用户目标

73
00:03:26,000 --> 00:03:27,320
我们将调用该工具

74
00:03:27,320 --> 00:03:30,020
而非直接将信息传递到提示中

75
00:03:30,020 --> 00:03:32,399
这鼓励代理使用工具

76
00:03:32,399 --> 00:03:34,319
在获取这些信息后

77
00:03:34,319 --> 00:03:37,190
我们将提供思维链指令

78
00:03:37,190 --> 00:03:39,890
仔细重复这些步骤直到完成

79
00:03:39,890 --> 00:03:42,250
以下是代理需要遵循的步骤

80
00:03:42,250 --> 00:03:44,579
获取所有可用文件的列表

81
00:03:44,579 --> 00:03:46,399
然后针对该文件列表

82
00:03:46,399 --> 00:03:49,850
评估每个文件的相关性

83
00:03:49,850 --> 00:03:55,410
然后使用建议文件工具将建议文件记录到记忆中

84
00:03:55,410 --> 00:03:56,390
此步骤

85
00:03:56,390 --> 00:03:57,110
第三步

86
00:03:57,110 --> 00:03:58,470
鼓励八和二

87
00:03:58,470 --> 00:04:03,860
使用获取建议文件工具获取建议文件列表非常重要

88
00:04:03,860 --> 00:04:09,360
代理可能在自身推理和对话历史中意识到

89
00:04:09,360 --> 00:04:13,080
文件列表可能是什么以及它认为的建议文件

90
00:04:13,080 --> 00:04:14,820
但与其依赖这一点

91
00:04:14,820 --> 00:04:20,209
我们希望代理仅使用已保存到建议文件的记忆

92
00:04:20,209 --> 00:04:21,570
此处的记忆

93
00:04:21,570 --> 00:04:24,630
获取建议文件工具会访问该记忆

94
00:04:24,630 --> 00:04:29,210
完成此循环实际上促使模型专注于记忆内容

95
00:04:29,210 --> 00:04:32,730
而非对话历史中的记忆

96
00:04:32,730 --> 00:04:33,270
然后

97
00:04:33,270 --> 00:04:36,150
从工具调用返回的结果是

98
00:04:36,150 --> 00:04:38,530
将呈现给用户供其审批

99
00:04:38,530 --> 00:04:39,930
如果用户批准

100
00:04:39,930 --> 00:04:42,430
则继续说这很棒

101
00:04:42,430 --> 00:04:44,070
通常建议的文件

102
00:04:44,070 --> 00:04:45,810
但如果用户有反馈

103
00:04:45,810 --> 00:04:50,650
返回步骤一并根据反馈重复流程

104
00:04:51,770 --> 00:04:54,010
现在可以定义代理使用的工具

105
00:04:55,250 --> 00:04:58,130
第一个工具是获取已批准用户目标

106
00:04:58,130 --> 00:05:02,070
此功能在提供的工具模块中定义

107
00:05:02,070 --> 00:05:06,100
它仅返回存储在状态中的已批准用户目标

108
00:05:06,100 --> 00:05:08,600
我们还将导入一个小助手函数

109
00:05:08,600 --> 00:05:10,840
这些即将定义的工具

110
00:05:10,840 --> 00:05:14,360
将使用这些工具与文件系统交互

111
00:05:14,360 --> 00:05:16,140
但并非整个文件系统

112
00:05:16,140 --> 00:05:19,860
它们仅限于查看可导入的文件

113
00:05:19,860 --> 00:05:24,720
新四J本身可以访问导入目录

114
00:05:24,720 --> 00:05:28,080
这个助手将告知导入目录的位置

115
00:05:28,080 --> 00:05:32,120
所有工具均可使用该导入目录确定可用文件

116
00:05:32,120 --> 00:05:34,830
并在这些文件中选择需要使用的

117
00:05:35,190 --> 00:05:37,990
然后定义列出导入文件的工具

118
00:05:37,990 --> 00:05:39,690
并将结果保存到此键

119
00:05:39,690 --> 00:05:41,310
所有可用文件

120
00:05:41,310 --> 00:05:43,430
工具调用需要工具上下文

121
00:05:43,430 --> 00:05:46,350
因为我们将使用一些辅助工具

122
00:05:46,350 --> 00:05:48,310
实际获取磁盘上的目录

123
00:05:48,310 --> 00:05:49,650
这些文件存储的位置

124
00:05:49,650 --> 00:05:55,140
因此列出的文件仅为相对路径而非绝对路径

125
00:05:55,140 --> 00:05:56,840
在实现部分可以看到

126
00:05:56,840 --> 00:05:58,480
我们将获取此辅助函数

127
00:05:58,480 --> 00:06:00,400
获取四J导入器

128
00:06:00,400 --> 00:06:04,510
这是四J可访问的数据导入目录

129
00:06:04,510 --> 00:06:06,510
数据无法访问整个磁盘空间

130
00:06:06,510 --> 00:06:07,910
因此不能使用绝对路径

131
00:06:07,910 --> 00:06:10,370
必须基于此导入目录

132
00:06:10,370 --> 00:06:11,930
在此处获取该目录

133
00:06:11,930 --> 00:06:14,070
然后列出所有文件

134
00:06:14,070 --> 00:06:17,240
这只是一个使用导入目录的字符串

135
00:06:17,240 --> 00:06:20,320
我们继续对目录进行全局列表

136
00:06:20,320 --> 00:06:22,560
从该目录递归向下

137
00:06:22,560 --> 00:06:27,240
并通过列表推导生成相对文件列表

138
00:06:27,560 --> 00:06:31,040
将结果保存到当前状态的可用文件

139
00:06:31,040 --> 00:06:34,280
然后将此作为工具调用结果返回

140
00:06:34,699 --> 00:06:37,579
接下来定义样本文件工具调用

141
00:06:37,579 --> 00:06:41,950
样本文件工具同样使用工具上下文

142
00:06:42,110 --> 00:06:44,650
并使用文件路径

143
00:06:44,650 --> 00:06:46,910
这是目标文件的相对路径

144
00:06:46,910 --> 00:06:52,300
语言模型决定要查看的文件

145
00:06:52,300 --> 00:06:56,360
可能调用操作系统执行类似cat的操作

146
00:06:56,360 --> 00:06:58,100
我们将全部用Python实现

147
00:06:58,100 --> 00:07:02,020
此工具调用结果仅为文本前100行

148
00:07:02,020 --> 00:07:04,049
假设为文本文件

149
00:07:04,049 --> 00:07:05,489
获取100行文本

150
00:07:05,489 --> 00:07:06,009
返回该结果

151
00:07:06,009 --> 00:07:08,929
现在这个工具调用的值

152
00:07:08,929 --> 00:07:10,770
这里我们设置了几个防护措施

153
00:07:10,770 --> 00:07:12,970
因为语言模型可能生成路径

154
00:07:12,970 --> 00:07:14,510
它可以生成各种不同的内容

155
00:07:14,510 --> 00:07:15,530
当它调用这个功能时

156
00:07:15,530 --> 00:07:19,120
我们将对传入的文件路径进行合理性检查

157
00:07:19,120 --> 00:07:21,020
确保它不是绝对路径

158
00:07:21,020 --> 00:07:22,500
如果它是绝对路径

159
00:07:22,500 --> 00:07:23,780
我们将返回一个错误

160
00:07:23,780 --> 00:07:25,970
因为它必须是相对文件

161
00:07:25,970 --> 00:07:28,940
并且预期这些文件相对于导入目录

162
00:07:28,940 --> 00:07:30,300
最后这部分

163
00:07:30,300 --> 00:07:35,160
我们也鼓励代理记住传入的文件路径

164
00:07:35,160 --> 00:07:37,990
应出现在可用文件列表中

165
00:07:37,990 --> 00:07:40,190
所以它应该实际检查这一点

166
00:07:40,190 --> 00:07:41,670
基于导入目录

167
00:07:41,670 --> 00:07:43,570
我们获取该文件的完整路径

168
00:07:43,570 --> 00:07:45,710
再次确认文件存在

169
00:07:45,710 --> 00:07:46,950
返回有用的错误信息

170
00:07:46,950 --> 00:07:47,930
如果文件不存在

171
00:07:47,930 --> 00:07:50,919
以便各方采取纠正措施

172
00:07:51,159 --> 00:07:52,559
如果文件存在

173
00:07:52,559 --> 00:07:56,199
我们将读取前100行并保存到内容中

174
00:07:56,199 --> 00:07:59,050
作为成功的工具调用返回

175
00:07:59,050 --> 00:08:00,750
如果发生任何错误

176
00:08:00,750 --> 00:08:04,770
我们将传递该错误作为对黄色语言模型的响应

177
00:08:04,770 --> 00:08:07,610
代理可以决定是否能处理

178
00:08:07,610 --> 00:08:10,990
或只需向用户报错

179
00:08:10,990 --> 00:08:13,450
你已赋予代理列出所有文件的能力

180
00:08:13,450 --> 00:08:14,870
查看这些文件

181
00:08:14,870 --> 00:08:19,060
现在它能基于这些文件和内容提出建议

182
00:08:19,060 --> 00:08:23,229
但代理认为用户需要的相关文件

183
00:08:23,229 --> 00:08:25,389
我们有一组工具实现此功能

184
00:08:25,389 --> 00:08:27,909
第一个是设置建议文件列表

185
00:08:27,909 --> 00:08:30,900
接受应为文件路径的字符串列表

186
00:08:30,900 --> 00:08:32,860
你可以在此添加额外检查

187
00:08:32,860 --> 00:08:38,330
确保传入的列表都是实际存在的文件

188
00:08:38,330 --> 00:08:39,750
我们在此稍作信任处理

189
00:08:39,750 --> 00:08:41,450
这个工具存在一定的冒险性

190
00:08:41,450 --> 00:08:42,770
当然可以改进

191
00:08:42,770 --> 00:08:44,500
你可以添加此检查

192
00:08:44,500 --> 00:08:45,820
另一方面

193
00:08:45,820 --> 00:08:49,520
我们将有一个获取建议文件的工具

194
00:08:49,520 --> 00:08:52,580
查看已建议的文件列表

195
00:08:53,910 --> 00:08:59,370
当代理成功确定相关文件后

196
00:08:59,370 --> 00:09:01,030
并向用户提出建议

197
00:09:01,030 --> 00:09:02,210
如果用户已批准

198
00:09:02,210 --> 00:09:02,770
当然

199
00:09:02,770 --> 00:09:07,260
将调用批准建议文件工具进行状态转移

200
00:09:07,260 --> 00:09:10,150
将建议文件状态转为已批准

201
00:09:10,150 --> 00:09:11,830
正如上一课中

202
00:09:11,830 --> 00:09:15,360
在调用此功能前我们将再次确认

203
00:09:15,360 --> 00:09:18,160
确保建议的文件确实存在于状态中

204
00:09:18,160 --> 00:09:23,810
若未建议则需让代理先查明情况再调用此工具

205
00:09:23,810 --> 00:09:24,930
如果已设置

206
00:09:24,930 --> 00:09:29,130
我将复制建议文件到批准文件并返回结果

207
00:09:29,130 --> 00:09:31,610
作为此工具调用的成功响应

208
00:09:31,610 --> 00:09:34,250
然后你可以将所有工具定义

209
00:09:34,250 --> 00:09:35,790
整理成列表

210
00:09:35,790 --> 00:09:38,570
并保存为文件建议代理工具

211
00:09:38,570 --> 00:09:40,190
我们将用于代理定义

212
00:09:40,190 --> 00:09:41,390
稍后即会看到

213
00:09:41,390 --> 00:09:43,670
现在你可以定义你的代理

214
00:09:43,670 --> 00:09:45,730
代理定义非常直接

215
00:09:45,730 --> 00:09:49,030
我们已完成了工具设置和提示定义

216
00:09:49,030 --> 00:09:52,190
只需将这些内容传入并创建代理

217
00:09:53,459 --> 00:09:54,819
拥有代理后

218
00:09:54,819 --> 00:09:57,260
现在可以与代理交互

219
00:09:57,260 --> 00:09:57,860
导入

220
00:09:57,860 --> 00:10:00,440
我们之前定义的make agent color助手

221
00:10:00,440 --> 00:10:03,700
然后使用该助手创建调用者

222
00:10:03,700 --> 00:10:06,840
这里只有一个细微不同之处

223
00:10:06,840 --> 00:10:08,740
当我们使用make agent color时

224
00:10:08,740 --> 00:10:10,940
只需直接调用代理

225
00:10:10,940 --> 00:10:12,370
我们想要执行

226
00:10:12,370 --> 00:10:17,750
注意这里我们用批准的用户目标初始化状态

227
00:10:17,750 --> 00:10:18,310
正如之前所说

228
00:10:18,310 --> 00:10:19,710
在工作流程开始时

229
00:10:19,710 --> 00:10:20,870
批准的用户目标

230
00:10:20,870 --> 00:10:23,390
是所有代理的总体方向

231
00:10:23,390 --> 00:10:24,850
以及它们要完成的任务

232
00:10:24,850 --> 00:10:30,550
因此在最终生产系统和多代理系统中必须设置此内容

233
00:10:30,550 --> 00:10:32,910
到此工作流程阶段时

234
00:10:32,910 --> 00:10:35,490
状态中已包含用户目标

235
00:10:35,490 --> 00:10:38,000
因为我们已完成了前期工作流程

236
00:10:38,000 --> 00:10:40,420
而此处尚未经历该阶段

237
00:10:40,420 --> 00:10:42,640
通过设置初始状态模拟此过程

238
00:10:42,640 --> 00:10:48,130
如同已批准一个需要进行供应链分析的用户目标

239
00:10:48,130 --> 00:10:53,470
描述涉及制造产品的多层次物料清单

240
00:10:53,850 --> 00:10:56,270
然后可以运行简短对话

241
00:10:56,270 --> 00:10:59,450
用户询问可用文件用于导入

242
00:10:59,450 --> 00:11:03,290
文件建议代理将执行所有处理

243
00:11:03,290 --> 00:11:07,020
确定可用文件及相关文件

244
00:11:07,020 --> 00:11:11,640
最终可用文件列表应包含目录中所有文件

245
00:11:11,640 --> 00:11:13,860
建议文件是其中子集

246
00:11:13,860 --> 00:11:16,120
希望仅为CSV文件

247
00:11:16,360 --> 00:11:18,420
这可能需要几秒钟处理

248
00:11:18,420 --> 00:11:19,920
因为语言模型

249
00:11:19,920 --> 00:11:20,240
当然

250
00:11:20,240 --> 00:11:24,420
正在分析所有找到的文件以判断相关性

251
00:11:24,420 --> 00:11:27,980
我们可以看到这个响应做得相当不错

252
00:11:27,980 --> 00:11:31,300
它已经识别出这些装配件的csv文件

253
00:11:31,300 --> 00:11:32,180
一些组件

254
00:11:32,180 --> 00:11:34,780
从零件到供应商的映射

255
00:11:34,780 --> 00:11:36,140
一些产品本身

256
00:11:36,140 --> 00:11:37,240
供应商本身

257
00:11:37,240 --> 00:11:40,140
还有一些完美的零件

258
00:11:40,290 --> 00:11:41,730
如果查看可用文件

259
00:11:41,730 --> 00:11:43,090
有很多额外文件

260
00:11:43,090 --> 00:11:45,150
特别是所有这些markdown文件

261
00:11:45,150 --> 00:11:46,310
它已经忽略了这些

262
00:11:46,310 --> 00:11:49,330
并正确建议了这些装配文件

263
00:11:49,330 --> 00:11:50,210
组件文件

264
00:11:50,210 --> 00:11:51,490
所有的csv文件

265
00:11:51,490 --> 00:11:52,830
太棒了

266
00:11:53,240 --> 00:11:56,350
由于代理提出了这些优秀建议

267
00:11:56,350 --> 00:11:58,790
你可以继续向代理发送新消息

268
00:11:58,790 --> 00:11:59,670
只需说同意

269
00:11:59,670 --> 00:12:00,550
我们来做吧

270
00:12:00,550 --> 00:12:01,850
可以重新表述这句话

271
00:12:01,850 --> 00:12:04,090
或许根据代理的回应

272
00:12:04,090 --> 00:12:05,870
这可能不是批准的好方法

273
00:12:05,870 --> 00:12:07,170
让我们试试这个

274
00:12:07,170 --> 00:12:09,839
代理对此非常满意

275
00:12:10,319 --> 00:12:13,599
应该调用工具以批准这些文件

276
00:12:13,599 --> 00:12:17,839
从会话状态可见，已批准文件与之前一致

277
00:12:17,839 --> 00:12:20,640
建议文件成功通过

278
00:12:20,640 --> 00:12:22,720
你现在已构建了两个代理

279
00:12:22,720 --> 00:12:26,339
构建结构化数据知识图谱的流程

280
00:12:26,339 --> 00:12:28,919
第一个确定用户意图

281
00:12:28,919 --> 00:12:30,959
下一个基于用户意图

282
00:12:30,959 --> 00:12:33,159
寻找可用的数据文件

283
00:12:33,159 --> 00:12:35,420
支持用户意图的文件

284
00:12:35,420 --> 00:12:36,320
在下一课中

285
00:12:36,320 --> 00:12:37,420
你将进行下一步操作

286
00:12:37,420 --> 00:12:39,400
在给定用户意图的情况下

287
00:12:39,400 --> 00:12:40,640
文件已可用

288
00:12:40,640 --> 00:12:42,920
知识图谱可能是什么样子

