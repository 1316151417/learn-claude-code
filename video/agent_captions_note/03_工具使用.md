# 模块三：工具使用 - 精读笔记

> 📚 **吴恩达 Agentic AI 教程 | 模块3 (p14-p18)**
>
> 工具使用是智能体AI的核心能力之一，它让LLM能够突破自身限制，调用外部API和服务来完成更多任务。

---

## 一、核心概念解析

### 1.1 什么是工具？

**定义**：工具是赋予LLM可调用的功能，使其能够完成超越语言模型自身能力的任务。

**通俗理解**：
- LLM就像一个**聪明的大脑**，但它被困在"文本世界"里
- 工具就像是给大脑装上了**手脚和眼睛**
- 两者结合，AI就能真正"行动"起来

> 💡 **关键洞察**：工具是**能力**（Capabilities），Skills是**知识**（Knowledge）。工具执行任务，Skills指导如何执行。

---

### 1.2 函数调用（Function Calling）

**定义**：LLM决定何时调用哪个工具以及如何使用工具返回的信息。

**工作流程**：
```
┌─────────────────────────────────────────────────────────────┐
│                        函数调用流程                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 用户输入：                                               │
│     "什么是最好的咖啡机？"                                   │
│                                                             │
│  2. LLM分析并决定：                                          │
│     → 需要调用搜索工具                                       │
│     → 函数：web_search(query="best coffee machine")         │
│                                                             │
│  3. 执行工具调用：                                           │
│     → 调用 Google/Bing/DuckDuckGo 搜索API                   │
│     → 获取搜索结果                                           │
│                                                             │
│  4. LLM处理结果：                                            │
│     → 解析搜索结果                                           │
│     → 生成自然语言回答                                       │
│     → "根据最新评测，最好的咖啡机是..."                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 二、常见工具类型

### 2.1 工具分类全景图

```
┌─────────────────────────────────────────────────────────────┐
│                        工具生态系统                          │
├──────────────┬──────────────┬──────────────┬────────────────┤
│  信息检索类  │  执行计算类  │  生产力类   │   文件处理类   │
├──────────────┼──────────────┼──────────────┼────────────────┤
│ • 网络搜索   │ • 代码执行   │ • 邮件发送   │ • PDF转文本    │
│ • 数据库查询 │ • 数据分析   │ • 日程管理   │ • 图像分析     │
│ • RAG检索    │ • 数学计算   │ • 通知推送   │ • 文档解析     │
│ • API调用    │ • 仿真模拟   │ • CRM集成    │ • 音频转写     │
└──────────────┴──────────────┴──────────────┴────────────────┘
```

---

### 2.2 信息检索类工具

#### 🔍 网络搜索API

| 提供商 | 特点 | 适用场景 |
|--------|------|----------|
| **Google Search API** | 结果权威、覆盖广 | 商业应用 |
| **Bing Search API** | 微软生态集成 | 企业应用 |
| **DuckDuckGo API** | 隐私友好 | 隐私敏感场景 |
| **Tavily** | AI优化设计 | 智能体专用 |

**使用示例**：
```python
# 用户问："最新的iPhone发布日期是什么？"
tool_call = {
    "function": "web_search",
    "parameters": {
        "query": "iPhone latest release date 2024",
        "max_results": 5
    }
}

# 返回结果后LLM生成回答
```

---

#### 📚 数据库查询

**支持的数据库类型**：
- SQL数据库（MySQL, PostgreSQL, SQLite）
- NoSQL数据库（MongoDB, Redis）
- 向量数据库（Pinecone, Weaviate）
- 图数据库（Neo4j）

**使用场景**：
- 客户信息查询
- 订单状态查询
- 知识库检索
- 数据分析

---

#### 📄 RAG检索增强生成

**流程**：
```
用户问题
   ↓
向量化查询
   ↓
向量数据库检索相似文档
   ↓
检索结果 + 问题 → LLM
   ↓
生成基于上下文的回答
```

**优势**：
- 基于企业私有数据回答
- 减少幻觉（Hallucination）
- 可追溯信息来源

---

### 2.3 执行计算类工具

#### 💻 代码执行

**典型应用**：
```python
# 用户问："投资100美元，年化收益7%，30年后是多少？"

tool_call = {
    "function": "execute_python",
    "parameters": {
        "code": "principal = 100; rate = 0.07; years = 30; " +
                "result = principal * (1 + rate) ** years; " +
                "print(f'{result:.2f}')"
    }
}

# 输出：761.23
```

**适用场景**：
- 金融计算
- 数据分析
- 算法验证
- 统计分析

---

#### 📊 数据分析工具

**常用库集成**：
- Pandas（数据处理）
- NumPy（数值计算）
- Matplotlib/Plotly（可视化）
- Scikit-learn（机器学习）

**示例工作流**：
```
上传CSV文件
   ↓
Pandas读取和分析
   ↓
生成统计摘要
   ↓
Matplotlib可视化
   ↓
返回分析结果和图表
```

---

### 2.4 生产力类工具

#### 📧 邮件和通信

- Gmail API
- Outlook/Exchange API
- Slack/Discord Webhook
- 企业微信/钉钉集成

**应用场景**：
- 自动起草邮件
- 发送报告通知
- 客户跟进提醒

---

#### 📅 日程管理

- Google Calendar API
- Microsoft Graph API
- 日程冲突检测
- 会议安排

---

### 2.5 文件处理类工具

#### 📄 文档处理

| 格式 | 处理方式 | 应用 |
|------|----------|------|
| PDF | PDF转文本API | 发票处理、合同解析 |
| Word | 文档提取 | 报告生成 |
| Excel | 表格解析 | 数据提取 |
| 图片 | OCR/多模态模型 | 图像文字识别 |

#### 🖼️ 多模态处理

- 图像分析（内容描述、物体检测）
- 音频转写（Whisper API）
- 视频理解（关键帧提取）

---

## 三、MCP：模型上下文协议

### 3.1 什么是MCP？

**定义**：Model Context Protocol（模型上下文协议）是一个**标准化协议**，让AI应用能够与外部数据源和工具进行交互。

**核心价值**：
```
没有MCP：                          有MCP：
每个工具需要自定义集成            ────────→  标准化接口
   ↓                                    ↓
开发成本高                           开发效率高
维护困难                             易于扩展
兼容性问题                           即插即用
```

---

### 3.2 MCP架构

```
┌─────────────────────────────────────────────────────────────┐
│                        MCP 架构                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────┐              ┌───────────────────┐           │
│   │   LLM   │ ──────────>  │   MCP Client      │           │
│   └─────────┘              └───────────────────┘           │
│                                     │                       │
│                                     ▼                       │
│                          ┌───────────────────┐             │
│                          │   MCP Server      │             │
│                          │  (标准协议接口)     │             │
│                          └───────────────────┘             │
│                                     │                       │
│          ┌──────────────────────────┼───────────────────┐ │
│          ▼                          ▼                   ▼ ▼
│   ┌──────────┐           ┌──────────────┐    ┌─────────────┐
│   │ 文件系统  │           │   数据库      │    │  外部API    │
│   └──────────┘           └──────────────┘    └─────────────┘
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### 3.3 MCP的优势

| 优势 | 说明 |
|------|------|
| **标准化** | 一次集成，多处使用 |
| **安全性** | 统一的安全和权限管理 |
| **可扩展** | 轻松添加新的数据源 |
| **互操作性** | 不同AI应用可以共享同一工具 |

---

## 四、工具设计最佳实践

### 4.1 工具定义规范

**良好的工具定义**：
```json
{
  "name": "web_search",
  "description": "搜索互联网获取最新信息",
  "parameters": {
    "query": {
      "type": "string",
      "description": "搜索关键词"
    },
    "max_results": {
      "type": "integer",
      "description": "返回结果数量，默认5",
      "default": 5
    }
  }
}
```

**关键要素**：
- ✅ 清晰的工具名称
- ✅ 详细的描述（说明用途）
- ✅ 明确的参数类型
- ✅ 参数说明和默认值

---

### 4.2 工具选择策略

**LLM如何选择工具**：
```
用户输入
   ↓
分析意图
   ↓
判断所需能力
   ↓
选择合适工具
   ↓
决定是否需要工具
```

**决策因素**：
- 任务类型（搜索 vs 计算 vs 查询）
- 信息时效性（需要最新信息吗？）
- 数据来源（公开 vs 私有）
- 计算复杂度（简单推理 vs 复杂计算）

---

### 4.3 多工具协同

**示例：复杂的旅游规划**
```
用户："帮我规划去东京的旅行"
   ↓
工具1：web_search - 搜索最佳旅行时间
   ↓
工具2：flight_search - 查询航班信息
   ↓
工具3：hotel_search - 查询酒店价格
   ↓
工具4：map_api - 获取景点地图
   ↓
工具5：weather_api - 获取天气预报
   ↓
综合生成完整旅行计划
```

---

## 五、实际应用案例

### 案例1：智能问答系统

```
用户："今天的天气怎么样？"
   ↓
LLM判断：需要实时天气数据
   ↓
调用：weather_api(location="用户位置")
   ↓
返回：{ "temp": 25, "condition": "晴" }
   ↓
LLM生成："今天天气晴朗，气温25°C，适合外出。"
```

---

### 案例2：金融分析助手

```
用户："分析苹果公司最近一个季度的财务表现"
   ↓
工具1：web_search - 搜索财报发布日期
   ↓
工具2：database_query - 查询财务数据
   ↓
工具3：execute_python - 计算财务比率
   ↓
工具4：chart_generation - 生成可视化图表
   ↓
LLM生成分析报告
```

---

### 案例3：代码助手

```
用户："帮我写一个爬取豆瓣电影评分的脚本"
   ↓
LLM生成代码
   ↓
工具：execute_python - 运行代码
   ↓
工具：web_search - 查找API文档
   ↓
LLM根据错误修正代码
   ↓
返回可运行的脚本
```

---

## 六、关键要点总结

### 核心要点

1. **工具是AI的手脚**：让LLM突破文本世界限制，执行真实操作

2. **函数调用是核心机制**：
   - LLM决定何时使用工具
   - LLM决定如何使用工具
   - LLM处理工具返回结果

3. **MCP标准化接口**：
   - 降低集成成本
   - 提高开发效率
   - 统一安全标准

4. **工具选择的关键**：
   - 清晰的描述和参数定义
   - 合理的权限和错误处理
   - 考虑成本和性能

5. **多工具协同**：
   - 不同工具完成不同任务
   - 工作流编排很重要
   - 结果整合是关键

---

### 实践建议

| 场景 | 推荐工具 |
|------|----------|
| 实时信息查询 | 网络搜索API |
| 私有数据查询 | 数据库/RAG |
| 数据分析 | Python代码执行 |
| 文档处理 | 文件解析API |
| 业务流程 | 生产力工具集成 |

---

### 工具 vs Skills 对比

| 特性 | 工具 (Tools) | Skills |
|------|--------------|--------|
| 本质 | 能力 (Capabilities) | 知识 (Knowledge) |
| 作用 | 执行任务 | 指导执行 |
| 示例 | 搜索API、代码执行 | 编程规范、业务逻辑 |
| 格式 | 函数调用 | Markdown文档 |
| 关系 | 工具执行 | Skills指导 |

> 📌 **记忆口诀**：工具是"手"，Skills是"大脑中的知识"。手做动作，脑子指导动作。

---

## 七、思考题

1. 你的应用需要哪些类型的工具？
2. 如何设计清晰易用的工具接口？
3. 如何平衡工具调用成本和响应速度？
4. 如何处理工具调用失败的情况？

---

**下一模块预告**：构建智能体AI的实用技巧 - 学习如何系统化地评估、分析和优化智能体工作流，从原型到生产级应用。
